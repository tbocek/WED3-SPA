<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>Market</title>
</head>
<body>

<h2 >Coinmarketcap without releading page</h2>
<button type="submit" onClick="send();">Submit</button>
<p id="text">n/a</p>


<script type="text/javascript">
    function send() {
        fetch('/api')
        //fetch('https://api.coinmarketcap.com/v1/ticker/?limit=10')
                .then((resp) => resp.json())
                .then(data => {
                    //console.log(data);
                    let string = 'Markets:<br>';
                    for(let s of data) {
                        string += s.name + ', price=' + s.price_usd + '<br>';
                    }
                    let element = document.getElementById('text');
                    element.innerHTML = string;
                });
    }

    var connection = new WebSocket('ws://localhost:8080/ws');
    connection.onopen = function () {
        connection.send('Ping'); // Send the message 'Ping' to the server
    };
    let counter = 0;
    connection.onmessage = function (e) {
        console.log('update: ' + counter++);
        let string = 'Markets:<br>';
        for(let s of JSON.parse(e.data)) {
            string += s.name + ', price=' + s.price_usd + '<br>';
        }
        let element = document.getElementById('text');
        element.innerHTML = string;
    };

</script>
</body>
</html>